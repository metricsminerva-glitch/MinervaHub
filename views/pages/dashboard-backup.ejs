<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== "undefined" ? title + " - " : "" %>Minerva Metrics Hub</title>
  
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts - Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/css/style.css">
  
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  
  <!-- Navigation -->
  <%- include("../partials/navbar") %>
  
  <!-- Flash Messages -->
  <%- include("../partials/flash") %>
  
  <!-- Main Content -->
  <main class="flex-grow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-4xl font-black text-gray-900 mb-2">
      Welcome back, <span class="text-indigo-600"><%= agency.agency_name %></span>!
    </h1>
    <p class="text-gray-600">Here's what's happening with your agency</p>
  </div>

  <!-- Status Alert -->
  <% if (agency.status === 'pending') { %>
    <div class="alert alert-warning mb-8">
      <i class="fas fa-clock alert-icon"></i>
      <div class="alert-content">
        <h3 class="font-bold text-lg mb-1">Pending Approval</h3>
        <p>Your agency profile is awaiting admin approval. You'll be able to access all features once approved.</p>
      </div>
    </div>
  <% } else if (agency.status === 'rejected') { %>
    <div class="alert alert-error mb-8">
      <i class="fas fa-times-circle alert-icon"></i>
      <div class="alert-content">
        <h3 class="font-bold text-lg mb-1">Application Rejected</h3>
        <p>Your agency application has been rejected. Please contact support for more information.</p>
      </div>
    </div>
  <% } %>

  <!-- Stats Grid -->
  <div class="grid md:grid-cols-4 gap-6 mb-8">
    <!-- Projects Stat -->
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <div class="w-14 h-14 bg-indigo-600 rounded-xl flex items-center justify-center">
          <i class="fas fa-project-diagram text-2xl text-white"></i>
        </div>
        <span class="text-4xl font-black text-gray-900"><%= stats.projects %></span>
      </div>
      <p class="text-gray-600 font-semibold">Projects Created</p>
    </div>

    <!-- Responses Stat -->
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <div class="w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center">
          <i class="fas fa-reply text-2xl text-white"></i>
        </div>
        <span class="text-4xl font-black text-gray-900"><%= stats.responses %></span>
      </div>
      <p class="text-gray-600 font-semibold">Responses Sent</p>
    </div>

    <!-- Rating Stat -->
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <div class="w-14 h-14 bg-amber-500 rounded-xl flex items-center justify-center">
          <i class="fas fa-star text-2xl text-white"></i>
        </div>
        <span class="text-4xl font-black text-gray-900"><%= agency.rating_average.toFixed(1) %></span>
      </div>
      <p class="text-gray-600 font-semibold">Average Rating</p>
      <p class="text-sm text-gray-500 mt-1"><%= agency.rating_count %> reviews</p>
    </div>

    <!-- Subscription Stat -->
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <div class="w-14 h-14 bg-indigo-500 rounded-xl flex items-center justify-center">
          <i class="fas fa-crown text-2xl text-white"></i>
        </div>
        <span class="text-2xl font-black text-gray-900 capitalize"><%= agency.subscription_tier %></span>
      </div>
      <p class="text-gray-600 font-semibold">Subscription</p>
    </div>
  </div>

  <!-- Monthly Limits (Free Tier) -->
  <% if (agency.subscription_tier === 'free') { %>
    <div class="card-border border-indigo-300 p-8 mb-8">
      <div class="flex items-start justify-between mb-6">
        <div>
          <h3 class="text-2xl font-bold text-gray-900 mb-2">Monthly Usage</h3>
          <p class="text-gray-600">Track your free tier limits</p>
        </div>
        <a href="/subscriptions/checkout/pro" class="btn btn-primary">
          <i class="fas fa-arrow-up mr-2"></i>Upgrade to Pro
        </a>
      </div>
      
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Projects Usage -->
        <div class="card shadow-sm">
          <div class="flex items-center justify-between mb-3">
            <span class="text-gray-700 font-semibold">Projects</span>
            <span class="text-2xl font-black text-indigo-600"><%= agency.projects_created_this_month %> / 1</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
            <div class="bg-indigo-600 h-3 rounded-full transition-all" style="width: <%= Math.min((agency.projects_created_this_month / 1) * 100, 100) %>%"></div>
          </div>
          <% if (agency.projects_created_this_month >= 1) { %>
            <p class="text-sm text-red-600 mt-2 font-semibold">
              <i class="fas fa-exclamation-triangle mr-1"></i>Limit reached
            </p>
          <% } %>
        </div>
        
        <!-- Responses Usage -->
        <div class="bg-white rounded-xl p-6 shadow-md">
          <div class="flex items-center justify-between mb-3">
            <span class="text-gray-700 font-semibold">Responses</span>
            <span class="text-2xl font-black text-green-600"><%= agency.responses_sent_this_month %> / 5</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
            <div class="bg-emerald-500 h-3 rounded-full transition-all" style="width: <%= Math.min((agency.responses_sent_this_month / 5) * 100, 100) %>%"></div>
          </div>
          <% if (agency.responses_sent_this_month >= 5) { %>
            <p class="text-sm text-red-600 mt-2 font-semibold">
              <i class="fas fa-exclamation-triangle mr-1"></i>Limit reached
            </p>
          <% } %>
        </div>
      </div>
    </div>
  <% } %>

  <!-- Quick Actions -->
  <div class="grid md:grid-cols-3 gap-6 mb-8">
    <a href="/projects/create" class="card card-hover text-center group">
      <div class="w-16 h-16 bg-indigo-600 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition">
        <i class="fas fa-plus-circle text-3xl text-white"></i>
      </div>
      <h3 class="font-bold text-xl text-gray-900 mb-2">Create Project</h3>
      <p class="text-gray-600">Post a new collaboration opportunity</p>
    </a>

    <a href="/projects" class="card card-hover text-center group">
      <div class="w-16 h-16 bg-emerald-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition">
        <i class="fas fa-search text-3xl text-white"></i>
      </div>
      <h3 class="font-bold text-xl text-gray-900 mb-2">Browse Projects</h3>
      <p class="text-gray-600">Find collaboration opportunities</p>
    </a>

    <a href="/profile/edit" class="card card-hover text-center group">
      <div class="w-16 h-16 bg-indigo-500 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition">
        <i class="fas fa-user-edit text-3xl text-white"></i>
      </div>
      <h3 class="font-bold text-xl text-gray-900 mb-2">Edit Profile</h3>
      <p class="text-gray-600">Update your agency information</p>
    </a>
  </div>

	  <!-- Certifications Preview -->
	  <% const dashCerts = agency.certifications ? JSON.parse(agency.certifications) : []; %>
	  <% if (dashCerts.length > 0) { %>
	    <div class="card mb-8">
	      <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
	        <i class="fas fa-certificate text-emerald-500 mr-3"></i>Your Certifications
	      </h2>
	      <div class="flex flex-wrap gap-3">
	        <% dashCerts.forEach(cert => { %>
	          <span class="badge badge-success">
	            <i class="fas fa-check-circle mr-2"></i><%= cert %>
	          </span>
	        <% }) %>
	      </div>
	      <a href="/profile/edit" class="text-indigo-600 hover:text-indigo-700 font-semibold mt-4 inline-block">
	        <i class="fas fa-edit mr-2"></i>Manage Certifications
	      </a>
	    </div>
	  <% } %>

	  <!-- Recent Projects -->
	  <div class="card">
	    <div class="flex items-center justify-between mb-6">
	      <h2 class="text-2xl font-bold text-gray-900">Recent Projects</h2>
	      <a href="/projects/my" class="text-indigo-600 hover:text-indigo-700 font-semibold">
	        View All <i class="fas fa-arrow-right ml-1"></i>
	      </a>
	    </div>
	    
	    <% if (recentProjects.length > 0) { %>
	      <div class="space-y-4">
	        <% recentProjects.forEach(project => { %>
	          <div class="card-border p-6 hover:border-indigo-300 transition">
	            <div class="flex justify-between items-start gap-4">
	              <div class="flex-1">
	                <h3 class="font-bold text-lg mb-2">
	                  <a href="/projects/<%= project.id %>" class="text-gray-900 hover:text-indigo-600 transition"><%= project.title %></a>
	                </h3>
	                <p class="text-gray-600 mb-3"><%= project.description.substring(0, 150) %><%= project.description.length > 150 ? '...' : '' %></p>
	                <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500">
	                  <span class="badge badge-primary capitalize">
	                    <%= project.project_type.replace('_', ' ') %>
	                  </span>
	                  <span class="flex items-center">
	                    <i class="fas fa-calendar mr-2"></i>
	                    <%= new Date(project.created_at).toLocaleDateString() %>
	                  </span>
	                </div>
	              </div>
	              <span class="badge <%= project.status === 'open' ? 'badge-success' : 'badge-secondary' %>">
	                <%= project.status %>
	              </span>
	            </div>
	          </div>
	        <% }) %>
	      </div>
	    <% } else { %>
	      <div class="text-center py-12">
	        <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
	          <i class="fas fa-folder-open text-4xl text-indigo-600"></i>
	        </div>
	        <p class="text-gray-600 mb-4">No projects yet</p>
	        <a href="/projects/create" class="btn btn-primary inline-block">
	          <i class="fas fa-plus mr-2"></i>Create Your First Project
	        </a>
	      </div>
	     <% } %>
  </div>
    </div>
  </main>
  
  <!-- Footer -->
  <%- include("../partials/footer") %>
  
</body>
</html>

