<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== "undefined" ? title + " - " : "" %>Minerva Metrics Hub</title>
  
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts - Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/css/style.css">
  
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  
  <!-- Navigation -->
  <%- include("../partials/navbar") %>
  
  <!-- Flash Messages -->
  <%- include("../partials/flash") %>
  
  <!-- Main Content -->
  <main class="flex-grow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
	  <div class="card p-8 mb-8">
	    <div class="flex justify-between items-start mb-6">
	      <div>
	        <div class="flex items-center gap-3 mb-2">
	          <h1 class="text-3xl font-bold text-gray-900"><%= project.title %></h1>
	          <% if (project.hide_identity === 1) { %>
	            <span class="badge badge-secondary">
	              <i class="fas fa-eye-slash mr-1"></i>Identity Hidden
	            </span>
	          <% } %>
	        </div>
	        <div class="flex items-center space-x-4 text-gray-600 text-sm">
	          <span>
	            <i class="fas fa-building mr-1"></i> 
	            <% if (project.is_hidden) { %>
	              <span class="text-gray-600 font-semibold">Agency Hidden</span>
	            <% } else { %>
	              <a href="/agencies/<%= project.agency_id %>" class="text-indigo-600 hover:text-indigo-700 font-semibold"><%= project.agency_name %></a>
	            <% } %>
	          </span>
	          <span>
	            <i class="fas fa-star text-amber-500 mr-1"></i> 
	            <%= project.rating_average.toFixed(1) %> (<%= project.rating_count %> reviews)
	          </span>
	          <span>
	            <i class="fas fa-calendar mr-1"></i> 
	            <%= new Date(project.created_at).toLocaleDateString() %>
	          </span>
	        </div>
	      </div>
	      <span class="badge <%= project.status === 'open' ? 'badge-success' : 'badge-secondary' %>">
	        <%= project.status %>
	      </span>
	    </div>

	    <div class="mb-6">
	      <h2 class="text-xl font-bold mb-3 text-gray-900 border-b border-gray-200 pb-2">Description</h2>
	      <p class="text-gray-700 whitespace-pre-wrap"><%= project.description %></p>
	    </div>
	
	    <div class="grid md:grid-cols-2 gap-6 mb-6 border-b border-gray-200 pb-6">
	      <div>
	        <h3 class="font-bold mb-2 text-gray-700">Project Type</h3>
	        <span class="badge badge-primary capitalize"><%= project.project_type.replace('_', ' ') %></span>
	      </div>
	
	      <% if (project.platforms_involved) { %>
	        <div>
	          <h3 class="font-bold mb-2 text-gray-700">Platforms</h3>
	          <div class="flex flex-wrap gap-2">
	            <% project.platforms_involved.split(',').forEach(platform => { %>
	              <span class="badge badge-info">
	                <%= platform.trim() %>
	              </span>
	            <% }) %>
	          </div>
	        </div>
	      <% } %>
	
	      <% if (project.budget_range) { %>
	        <div>
	          <h3 class="font-bold mb-2 text-gray-700">Budget Range</h3>
	          <p class="text-gray-700 font-semibold"><%= project.budget_range %></p>
	        </div>
	      <% } %>
	
	      <% if (project.deadline) { %>
	        <div>
	          <h3 class="font-bold mb-2 text-gray-700">Deadline</h3>
	          <p class="text-gray-700 font-semibold"><%= new Date(project.deadline).toLocaleDateString() %></p>
	        </div>
	      <% } %>
	    </div>
	
	    <!-- Response Count -->
	    <div class="pt-4">
	      <p class="text-gray-600 font-semibold">
	        <i class="fas fa-reply mr-2 text-indigo-500"></i> <%= responseCount %> <%= responseCount === 1 ? 'response' : 'responses' %>
	      </p>
	    </div>
	
	    <!-- Owner Actions -->
	    <% if (isOwner) { %>
	      <div class="border-t border-gray-200 pt-4 mt-4">
	        <div class="flex space-x-4">
	          <a href="/projects/<%= project.id %>/responses" class="btn btn-primary">
	            <i class="fas fa-eye mr-2"></i> View Responses
	          </a>
	          <% if (project.status === 'open') { %>
	            <form action="/projects/<%= project.id %>/close" method="POST" class="inline">
	              <button type="submit" class="btn btn-secondary"
	                      onclick="return confirm('Are you sure you want to close this project?')">
	                <i class="fas fa-times-circle mr-2"></i> Close Project
	              </button>
	            </form>
	          <% } %>
	        </div>
	      </div>
	    <% } %>
	  </div>
	
	  <!-- Response Form (if not owner and logged in) -->
	  <% if (locals.user && !isOwner && project.status === 'open' && user.status === 'approved') { %>
	    <div class="card p-8">
	      <h2 class="text-2xl font-bold mb-6 text-gray-900">Send a Response</h2>
	      <form action="/projects/<%= project.id %>/respond" method="POST" class="space-y-4">
	        <div>
	          <label class="form-label">Your Message *</label>
	          <textarea name="message" rows="6" required 
	                    class="form-textarea"
	                    placeholder="Explain why you're interested and how you can help..."></textarea>
        </div>

	        <div>
	          <label class="form-label">Contact Email *</label>
	          <input type="email" name="contact_email" required value="<%= user.email %>"
	                 class="form-input">
	        </div>
	
	        <button type="submit" class="btn btn-primary">
	          <i class="fas fa-paper-plane mr-2"></i> Send Response
	        </button>
      </form>
    </div>
	  <% } else if (!locals.user) { %>
	    <div class="alert alert-info text-center">
	      <p class="text-gray-700 mb-4">Want to respond to this project?</p>
	      <a href="/login" class="btn btn-primary">Login to Respond</a>
	    </div>
	  <% } else if (locals.user && user.status !== 'approved') { %>
	    <div class="alert alert-warning text-center">
	      <p class="text-gray-700">Your account is pending approval. You'll be able to respond to projects once approved.</p>
	    </div>
	  <% } %>
    </div>
  </main>>
  
  <!-- Footer -->
  <%- include("../partials/footer") %>
  
</body>
</html>

