<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== "undefined" ? title + " - " : "" %>Minerva Metrics Hub</title>
  
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts - Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/css/style.css">
  
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
    .detail-field {
      padding: 1rem 0;
      border-bottom: 1px solid #f3f4f6;
    }
    .detail-field:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  
  <!-- Navigation -->
  <%- include("../partials/navbar") %>
  
  <!-- Flash Messages -->
  <%- include("../partials/flash") %>
  
  <!-- Main Content -->
  <main class="flex-grow">
    <div class="max-w-screen-lg mx-auto px-6 md:px-10 py-12">
      
      <!-- Enhanced Project Header -->
      <div class="bg-white rounded-xl shadow-md p-8 mb-8">
        <div class="flex justify-between items-start mb-8">
          <div class="flex-1">
            <div class="flex flex-wrap items-center gap-3 mb-5">
              <h1 class="text-5xl font-black text-gray-900"><%= project.title %></h1>
            </div>
            
            <div class="flex flex-wrap items-center gap-3 mb-5">
              <!-- Status Badge -->
              <span class="badge <%= project.status === 'open' ? 'badge-success' : 'badge-secondary' %> text-base px-4 py-2">
                <i class="fas fa-<%= project.status === 'open' ? 'check-circle' : 'times-circle' %> mr-2"></i><%= project.status %>
              </span>
              
              <% if (project.hide_identity === 1) { %>
                <span class="badge badge-secondary text-base px-4 py-2">
                  <i class="fas fa-eye-slash mr-2"></i>Identity Hidden
                </span>
              <% } %>
            </div>
            
            <div class="flex flex-wrap items-center gap-5 text-gray-600">
              <span class="flex items-center text-base">
                <i class="fas fa-building mr-2 text-indigo-600"></i> 
                <% if (project.is_hidden) { %>
                  <span class="font-semibold">Agency Hidden</span>
                <% } else { %>
                  <a href="/agencies/<%= project.agency_id %>" class="text-indigo-600 hover:text-indigo-700 font-semibold"><%= project.agency_name %></a>
                <% } %>
              </span>
              <span class="flex items-center text-base">
                <i class="fas fa-star text-amber-500 mr-2"></i> 
                <span class="font-semibold"><%= project.rating_average.toFixed(1) %></span>
                <span class="text-gray-500 ml-1">(<%= project.rating_count %> reviews)</span>
              </span>
              <span class="flex items-center text-base">
                <i class="fas fa-calendar mr-2 text-emerald-600"></i> 
                <%= new Date(project.created_at).toLocaleDateString() %>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Description Section -->
      <div class="bg-white rounded-xl shadow-md p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-900 flex items-center mb-2">
          <i class="fas fa-align-left mr-3 text-indigo-600"></i>Description
        </h2>
        <div class="border-b border-gray-200 mb-6"></div>
        <p class="text-gray-700 whitespace-pre-wrap leading-relaxed text-base"><%= project.description %></p>
      </div>

      <!-- Enhanced Project Details Grid -->
      <div class="bg-white rounded-xl shadow-md p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-900 flex items-center mb-6">
          <i class="fas fa-info-circle mr-3 text-indigo-600"></i>Project Details
        </h2>
        
        <div class="space-y-0">
          <!-- Project Type -->
          <div class="detail-field">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-tag text-xl text-indigo-600"></i>
              </div>
              <div class="flex-1">
                <h3 class="text-xs font-semibold text-gray-500 tracking-wide mb-2">Project Type</h3>
                <span class="badge badge-primary capitalize text-base px-4 py-2">
                  <%= project.project_type.replace('_', ' ') %>
                </span>
              </div>
            </div>
          </div>

          <!-- Platforms -->
          <% if (project.platforms_involved) { %>
            <div class="detail-field">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0">
                  <i class="fas fa-chart-line text-xl text-emerald-600"></i>
                </div>
                <div class="flex-1">
                  <h3 class="text-xs font-semibold text-gray-500 tracking-wide mb-2">Platforms</h3>
                  <div class="flex flex-wrap gap-2">
                    <% project.platforms_involved.split(',').forEach(platform => { %>
                      <span class="badge badge-info text-base px-4 py-2">
                        <%= platform.trim() %>
                      </span>
                    <% }) %>
                  </div>
                </div>
              </div>
            </div>
          <% } %>

          <!-- Budget Range -->
          <% if (project.budget_range) { %>
            <div class="detail-field">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                  <i class="fas fa-dollar-sign text-xl text-green-600"></i>
                </div>
                <div class="flex-1">
                  <h3 class="text-xs font-semibold text-gray-500 tracking-wide mb-2">Budget Range</h3>
                  <p class="text-gray-900 font-bold text-lg"><%= project.budget_range %></p>
                </div>
              </div>
            </div>
          <% } %>

          <!-- Deadline -->
          <% if (project.deadline) { %>
            <div class="detail-field">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                  <i class="fas fa-clock text-xl text-red-600"></i>
                </div>
                <div class="flex-1">
                  <h3 class="text-xs font-semibold text-gray-500 tracking-wide mb-2">Deadline</h3>
                  <p class="text-gray-900 font-bold text-lg"><%= new Date(project.deadline).toLocaleDateString() %></p>
                </div>
              </div>
            </div>
          <% } %>

          <!-- Response Count -->
          <div class="detail-field">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-reply text-xl text-purple-600"></i>
              </div>
              <div class="flex-1">
                <h3 class="text-xs font-semibold text-gray-500 tracking-wide mb-2">Responses</h3>
                <p class="text-gray-900 font-bold text-lg">
                  <%= responseCount %> <%= responseCount === 1 ? 'response' : 'responses' %> received
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Owner Actions -->
      <% if (isOwner) { %>
        <div class="bg-white rounded-xl shadow-md p-8 mb-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-900 flex items-center">
            <i class="fas fa-cog mr-3 text-indigo-600"></i>Project Actions
          </h2>
          <div class="flex flex-wrap gap-4">
            <a href="/projects/<%= project.id %>/responses" class="btn btn-primary px-8 py-3 shadow-md hover:shadow-lg">
              <i class="fas fa-eye mr-2"></i> View Responses
            </a>
            <a href="/projects/<%= project.id %>/edit" class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg">
              <i class="fas fa-edit mr-2"></i> Edit Project
            </a>
            <% if (project.status === 'open') { %>
              <form action="/projects/<%= project.id %>/close" method="POST" class="inline">
                <button 
                  type="submit" 
                  class="px-8 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition-all shadow-md hover:shadow-lg"
                  onclick="return confirm('Are you sure you want to close this project?')"
                >
                  <i class="fas fa-times-circle mr-2"></i> Close Project
                </button>
              </form>
            <% } %>
          </div>
        </div>
      <% } %>

      <!-- Response Form (if not owner and logged in) -->
      <% if (locals.user && !isOwner && project.status === 'open' && user.status === 'approved') { %>
        <div class="bg-white rounded-xl shadow-md p-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-900 flex items-center">
            <i class="fas fa-paper-plane mr-3 text-indigo-600"></i>Send a Response
          </h2>
          <form action="/projects/<%= project.id %>/respond" method="POST" class="space-y-6">
            <div>
              <label class="form-label flex items-center">
                <i class="fas fa-comment mr-2 text-indigo-600"></i>
                <span class="font-semibold">Your Message *</span>
              </label>
              <textarea 
                name="message" 
                rows="6" 
                required 
                class="form-textarea mt-2"
                placeholder="Explain why you're interested and how you can help..."
              ></textarea>
              <p class="text-sm text-gray-500 mt-2">Provide details about your experience and approach</p>
            </div>

            <div>
              <label class="form-label flex items-center">
                <i class="fas fa-envelope mr-2 text-indigo-600"></i>
                <span class="font-semibold">Contact Email *</span>
              </label>
              <input 
                type="email" 
                name="contact_email" 
                required 
                value="<%= user.email %>"
                class="form-input mt-2"
              >
              <p class="text-sm text-gray-500 mt-2">We'll use this to connect you with the project owner</p>
            </div>

            <button type="submit" class="btn btn-primary px-8 py-3 shadow-md hover:shadow-lg">
              <i class="fas fa-paper-plane mr-2"></i> Send Response
            </button>
          </form>
        </div>
      <% } else if (!locals.user) { %>
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-8 text-center">
          <i class="fas fa-info-circle text-4xl text-blue-600 mb-4"></i>
          <p class="text-gray-700 text-lg mb-4 font-semibold">Want to respond to this project?</p>
          <a href="/login" class="btn btn-primary inline-block px-8 py-3 shadow-md hover:shadow-lg">
            <i class="fas fa-sign-in-alt mr-2"></i>Login to Respond
          </a>
        </div>
      <% } else if (locals.user && user.status !== 'approved') { %>
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-8 text-center">
          <i class="fas fa-clock text-4xl text-amber-600 mb-4"></i>
          <p class="text-gray-700 text-lg font-semibold">Your account is pending approval. You'll be able to respond to projects once approved.</p>
        </div>
      <% } %>
      
    </div>
  </main>
  
  <!-- Footer -->
  <%- include("../partials/footer") %>
  
</body>
</html>
