<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== "undefined" ? title + " - " : "" %>Minerva Metrics Hub</title>
  
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts - Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="/css/style.css">
  
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  
  <!-- Navigation -->
  <%- include("../partials/navbar") %>
  
  <!-- Flash Messages -->
  <%- include("../partials/flash") %>
  
  <!-- Main Content -->
  <main class="flex-grow">
    <div class="max-w-screen-lg mx-auto px-6 md:px-10 py-12">
      
      <!-- Project Header -->
      <div class="bg-white rounded-xl shadow-md p-8 mb-8">
        <div class="flex justify-between items-start mb-6">
          <div class="flex-1">
            <div class="flex flex-wrap items-center gap-3 mb-4">
              <h1 class="text-4xl font-black text-gray-900"><%= project.title %></h1>
              <% if (project.hide_identity === 1) { %>
                <span class="badge badge-secondary">
                  <i class="fas fa-eye-slash mr-1"></i>Identity Hidden
                </span>
              <% } %>
            </div>
            
            <div class="flex flex-wrap items-center gap-4 text-gray-600">
              <span class="flex items-center text-base">
                <i class="fas fa-building mr-2 text-indigo-600"></i> 
                <% if (project.is_hidden) { %>
                  <span class="font-semibold">Agency Hidden</span>
                <% } else { %>
                  <a href="/agencies/<%= project.agency_id %>" class="text-indigo-600 hover:text-indigo-700 font-semibold"><%= project.agency_name %></a>
                <% } %>
              </span>
              <span class="flex items-center text-base">
                <i class="fas fa-star text-amber-500 mr-2"></i> 
                <span class="font-semibold"><%= project.rating_average.toFixed(1) %></span>
                <span class="text-gray-500 ml-1">(<%= project.rating_count %> reviews)</span>
              </span>
              <span class="flex items-center text-base">
                <i class="fas fa-calendar mr-2 text-emerald-600"></i> 
                <%= new Date(project.created_at).toLocaleDateString() %>
              </span>
            </div>
          </div>
          
          <span class="badge <%= project.status === 'open' ? 'badge-success' : 'badge-secondary' %> text-base px-4 py-2 shrink-0">
            <%= project.status %>
          </span>
        </div>
      </div>

      <!-- Description Section -->
      <div class="bg-white rounded-xl shadow-md p-8 mb-8">
        <h2 class="text-2xl font-bold mb-6 text-gray-900 flex items-center">
          <i class="fas fa-align-left mr-3 text-indigo-600"></i>Description
        </h2>
        <p class="text-gray-700 whitespace-pre-wrap leading-relaxed text-base"><%= project.description %></p>
      </div>

      <!-- Project Info Grid -->
      <div class="bg-white rounded-xl shadow-md p-8 mb-8">
        <h2 class="text-2xl font-bold mb-6 text-gray-900 flex items-center">
          <i class="fas fa-info-circle mr-3 text-indigo-600"></i>Project Details
        </h2>
        
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Project Type -->
          <div>
            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Project Type</h3>
            <span class="badge badge-primary capitalize text-base px-4 py-2">
              <i class="fas fa-tag mr-2"></i><%= project.project_type.replace('_', ' ') %>
            </span>
          </div>

          <!-- Platforms -->
          <% if (project.platforms_involved) { %>
            <div>
              <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Platforms</h3>
              <div class="flex flex-wrap gap-2">
                <% project.platforms_involved.split(',').forEach(platform => { %>
                  <span class="badge badge-info text-base px-4 py-2">
                    <i class="fas fa-chart-line mr-2"></i><%= platform.trim() %>
                  </span>
                <% }) %>
              </div>
            </div>
          <% } %>

          <!-- Budget Range -->
          <% if (project.budget_range) { %>
            <div>
              <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Budget Range</h3>
              <p class="text-gray-900 font-bold text-lg">
                <i class="fas fa-dollar-sign mr-2 text-emerald-600"></i><%= project.budget_range %>
              </p>
            </div>
          <% } %>

          <!-- Deadline -->
          <% if (project.deadline) { %>
            <div>
              <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Deadline</h3>
              <p class="text-gray-900 font-bold text-lg">
                <i class="fas fa-clock mr-2 text-red-600"></i><%= new Date(project.deadline).toLocaleDateString() %>
              </p>
            </div>
          <% } %>
        </div>

        <!-- Response Count -->
        <div class="mt-6 pt-6 border-t border-gray-200">
          <p class="text-gray-700 font-semibold text-base flex items-center">
            <i class="fas fa-reply mr-2 text-indigo-600"></i> 
            <%= responseCount %> <%= responseCount === 1 ? 'response' : 'responses' %> received
          </p>
        </div>
      </div>

      <!-- Owner Actions -->
      <% if (isOwner) { %>
        <div class="bg-white rounded-xl shadow-md p-8 mb-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-900 flex items-center">
            <i class="fas fa-cog mr-3 text-indigo-600"></i>Project Actions
          </h2>
          <div class="flex flex-wrap gap-4">
            <a href="/projects/<%= project.id %>/responses" class="btn btn-primary px-6 py-3">
              <i class="fas fa-eye mr-2"></i> View Responses
            </a>
            <% if (project.status === 'open') { %>
              <form action="/projects/<%= project.id %>/close" method="POST" class="inline">
                <button 
                  type="submit" 
                  class="px-6 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition-all"
                  onclick="return confirm('Are you sure you want to close this project?')"
                >
                  <i class="fas fa-times-circle mr-2"></i> Close Project
                </button>
              </form>
            <% } %>
          </div>
        </div>
      <% } %>

      <!-- Response Form (if not owner and logged in) -->
      <% if (locals.user && !isOwner && project.status === 'open' && user.status === 'approved') { %>
        <div class="bg-white rounded-xl shadow-md p-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-900 flex items-center">
            <i class="fas fa-paper-plane mr-3 text-indigo-600"></i>Send a Response
          </h2>
          <form action="/projects/<%= project.id %>/respond" method="POST" class="space-y-6">
            <div>
              <label class="form-label">Your Message *</label>
              <textarea 
                name="message" 
                rows="6" 
                required 
                class="form-textarea"
                placeholder="Explain why you're interested and how you can help..."
              ></textarea>
              <p class="text-sm text-gray-500 mt-2">Provide details about your experience and approach</p>
            </div>

            <div>
              <label class="form-label">Contact Email *</label>
              <input 
                type="email" 
                name="contact_email" 
                required 
                value="<%= user.email %>"
                class="form-input"
              >
              <p class="text-sm text-gray-500 mt-2">We'll use this to connect you with the project owner</p>
            </div>

            <button type="submit" class="btn btn-primary px-8 py-3">
              <i class="fas fa-paper-plane mr-2"></i> Send Response
            </button>
          </form>
        </div>
      <% } else if (!locals.user) { %>
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-8 text-center">
          <i class="fas fa-info-circle text-4xl text-blue-600 mb-4"></i>
          <p class="text-gray-700 text-lg mb-4 font-semibold">Want to respond to this project?</p>
          <a href="/login" class="btn btn-primary inline-block px-8 py-3">
            <i class="fas fa-sign-in-alt mr-2"></i>Login to Respond
          </a>
        </div>
      <% } else if (locals.user && user.status !== 'approved') { %>
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-8 text-center">
          <i class="fas fa-clock text-4xl text-amber-600 mb-4"></i>
          <p class="text-gray-700 text-lg font-semibold">Your account is pending approval. You'll be able to respond to projects once approved.</p>
        </div>
      <% } %>
      
    </div>
  </main>
  
  <!-- Footer -->
  <%- include("../partials/footer") %>
  
</body>
</html>
